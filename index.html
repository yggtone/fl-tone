<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">

<head>
  <title>Audio Test</title>
  <style>

      

        @keyframes highlight {
            0%{ background: rgba(255, 240, 140, 1); }
            100%{ background: rgba(255, 240, 140, 0); }
        }
        @-moz-keyframes highlight{
            0%{ background: rgba(255, 240, 140, 1); }
            100%{ background: rgba(255, 240, 140, 0); }
        }
        @-webkit-keyframes highlight{
            0%{ background: rgba(255, 240, 140, 1); }
            100%{ background: rgba(255, 240, 140, 0); }
        }


        body { padding: 0; }

        #container {
            padding: 20px;
        }

        .highlight {
            background: #fff68d;
        }

        .hero-unit {
            padding: 0;
        }

        #toucharea {
            padding: 30px;
        }
   

      

    </style>
</head>

<body>


<!--
<input type="button" value="Play" onclick="playSound(sourceA.source.buffer,0);"></input>
<input type="range" oninput="setPitch(sourceA.source,value);" value="1.0" step="0.0001" max="3.0" min="0.3"></input>
<BR>
<input type="button" value="Play" onclick="playSound(sourceA.source.buffer,0);"></input>
<input type="range" oninput="setPitch(sourceB.source,value);" value="1.0" step="0.001" max="3.0" min="0.3"></input>
-->

<div id="toucharea">

<h1>Touch And Audio Test</h1>
            <BR><BR><BR><BR><p>
</div>










<script src="js/buffer-loader.js"></script>
<script src="js/hammer.min.js"></script>
<script>

  var pitch = 1.5;


    
  //touch hammer scripts-------------------------
  //var hammertime = Hammer(document.getElementById("toucharea"));
  //  console.log(hammertime);
  new Hammer(document.getElementById("toucharea"),
  { drag_lock_to_axis: true }).on("drag", handleHammer);
 
  //touch events
  function handleHammer(ev) {
    console.log(ev);
    // disable browser scrolling
    //ev.gesture.preventDefault();
    var touches = ev.gesture.touches;

    for(var t = 0, len = touches.length; t < len; t++) {

        target = touches[t].target;
        //if(target.className.indexOf("drag") < 0) {
        //    return;
        //}
        target.style.left = (touches[t].pageX - 50) + "px";
        target.style.top = (touches[t].pageY - 50) + "px";
        //convert touch position to tone value as an initial test
        console.log('pos' + touches[t].pageX );
        pitch = touches[0].pageY;
        setPitch(sourceA.source,touches[t].pageY * 0.01);
    }
  }




window.onload = init;
var context;
var bufferLoader;

//var newestSource;



function init() {
  // Fix up prefixing
  window.AudioContext = window.AudioContext || window.webkitAudioContext;
  context = new AudioContext();

  bufferLoader = new BufferLoader(
    context,
    [
      'audio/sine440.wav',
      'audio/sine440.wav',
    ],
    finishedLoading
    );

  bufferLoader.load();
}

//new sounds must create a source each time
//part of the standard http://updates.html5rocks.com/2012/01/Web-Audio-FAQ
function playSound(buffer, time) {
  var source = context.createBufferSource();
  source.buffer = buffer;
  source.connect(context.destination);
  source.start(time);
  source.loop = true;
  //newestSource = source;
}


function createSource(buffer) {
  var source = context.createBufferSource();
  // Create a gain node.
  var gainNode = context.createGain();
  source.buffer = buffer;
  // Turn on looping.
  source.loop = true;
  // Connect source to gain.
  source.connect(gainNode);
  // Connect gain to destination.
  gainNode.connect(context.destination);

  return {
    source: source,
    gainNode: gainNode
  };
}

var sourceA, sourceB;

function finishedLoading(bufferList) {
  // Create two sources and play them both together.
  //var source1 = context.createBufferSource();
  //var source2 = context.createBufferSource();
  //source1.buffer = bufferList[0];
  //source2.buffer = bufferList[1];
  //source1.connect(context.destination);
  //source2.connect(context.destination);
  //source1.start(0);
  //source2.start(0);

  //prebuffer
  sourceA = createSource(bufferList[0]);
  sourceA.source.start(0);
  sourceA.gainNode.gain.value = 0.1;
  sourceA.source.playbackRate.value = 0.3;
  
  sourceB = createSource(bufferList[1]);
  sourceB.source.start(0);
  sourceB.gainNode.gain.value = 0.1;
  sourceB.source.playbackRate.value = 1.0;
}

function setPitch(source,rate) 
{  
  source.playbackRate.value = rate;

}

</script>



</html>
